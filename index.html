1<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Christmas Dinner 2025 - The Plan</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600&family=JetBrains+Mono:wght@400;500&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-dark: #1a1a1a;
      --bg-card: #242424;
      --bg-card-hover: #2a2a2a;
      --text-primary: #f5f5f5;
      --text-secondary: #a0a0a0;
      --text-muted: #666;
      --accent-green: #4ade80;
      --accent-amber: #fbbf24;
      --accent-red: #f87171;
      --accent-blue: #60a5fa;
      --accent-purple: #a78bfa;
      --accent-pink: #f472b6;
      --border: #333;
      --done: #22c55e;
      --todo: #eab308;
      --mum: #a78bfa;
      --tobuy: #f97316;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg-dark);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.6;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, #1e3a2f 0%, #1a1a1a 100%);
      border-bottom: 1px solid var(--border);
      padding: 1.5rem 2rem;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-content {
      max-width: 1800px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .header h1 {
      font-family: 'Crimson Pro', serif;
      font-size: 1.75rem;
      font-weight: 600;
      color: var(--accent-green);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .header h1::before {
      content: "üéÑ";
    }

    .mode-switcher {
      display: flex;
      gap: 0.5rem;
      background: var(--bg-card);
      padding: 0.25rem;
      border-radius: 8px;
    }

    .mode-btn {
      padding: 0.5rem 1rem;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      font-family: 'Inter', sans-serif;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      border-radius: 6px;
      transition: all 0.2s;
    }

    .mode-btn:hover {
      color: var(--text-primary);
    }

    .mode-btn.active {
      background: var(--accent-green);
      color: var(--bg-dark);
    }

    .time-setter {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .time-setter label {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .time-setter input {
      padding: 0.5rem 0.75rem;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--bg-card);
      color: var(--text-primary);
      font-family: 'JetBrains Mono', monospace;
      font-size: 1rem;
    }

    /* Main Content */
    .main {
      max-width: 1800px;
      margin: 0 auto;
      padding: 1rem;
    }


    /* LIZ MODE - Clean single column */
    .liz-mode {
      max-width: 800px;
      margin: 0 auto;
    }

    .liz-mode section {
      margin-bottom: 3rem;
    }

    .liz-mode h2 {
      font-family: 'Crimson Pro', serif;
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--accent-green);
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border);
    }

    .liz-mode h3 {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
      margin: 1.5rem 0 0.75rem;
    }

    .liz-mode table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
    }

    .liz-mode th, .liz-mode td {
      text-align: left;
      padding: 0.75rem;
      border-bottom: 1px solid var(--border);
    }

    .liz-mode th {
      font-weight: 500;
      color: var(--text-secondary);
      font-size: 0.875rem;
    }

    .liz-mode ul {
      list-style: none;
    }

    .liz-mode li {
      padding: 0.5rem 0;
      padding-left: 1.5rem;
      position: relative;
    }

    .liz-mode li::before {
      content: "‚òê";
      position: absolute;
      left: 0;
      color: var(--text-muted);
    }

    .liz-mode .task-done::before {
      content: "‚úì";
      color: var(--done);
    }

    /* SEB MODE - Multi-column dashboard (compact) */
    .seb-mode {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
    }

    @media (min-width: 1200px) {
      .seb-mode {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    .seb-card {
      background: var(--bg-card);
      border-radius: 8px;
      padding: 0.75rem;
      border: 1px solid var(--border);
      font-size: 0.8rem;
    }

    .seb-card h2 {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.65rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--accent-green);
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.35rem;
    }

    .seb-card h2::before {
      content: "";
      width: 6px;
      height: 6px;
      background: var(--accent-green);
      border-radius: 50%;
    }

    .menu-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.2rem 0;
      border-bottom: 1px solid var(--border);
    }

    .menu-item:last-child {
      border-bottom: none;
    }

    .menu-item-name {
      font-weight: 500;
      font-size: 0.8rem;
    }

    .status-badge {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.6rem;
      padding: 0.15rem 0.35rem;
      border-radius: 3px;
      text-transform: uppercase;
      font-weight: 500;
    }

    .status-done { background: rgba(34, 197, 94, 0.2); color: var(--done); }
    .status-prepped { background: rgba(34, 197, 94, 0.2); color: var(--done); }
    .status-mum { background: rgba(167, 139, 250, 0.2); color: var(--mum); }
    .status-todo { background: rgba(234, 179, 8, 0.2); color: var(--todo); }
    .status-tobuy { background: rgba(249, 115, 22, 0.2); color: var(--tobuy); }

    .task-list {
      list-style: none;
    }

    .task-item {
      display: flex;
      align-items: flex-start;
      gap: 0.4rem;
      padding: 0.15rem 0;
      font-size: 0.75rem;
      line-height: 1.3;
    }

    .task-checkbox {
      width: 14px;
      height: 14px;
      border: 1.5px solid var(--border);
      border-radius: 3px;
      flex-shrink: 0;
      margin-top: 1px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
    }

    .task-checkbox:hover {
      border-color: var(--accent-green);
    }

    .task-checkbox.checked {
      background: var(--accent-green);
      border-color: var(--accent-green);
    }

    .task-checkbox.checked::after {
      content: "‚úì";
      color: var(--bg-dark);
      font-size: 9px;
      font-weight: bold;
    }

    .task-text.completed {
      text-decoration: line-through;
      color: var(--text-muted);
    }

    .task-important {
      color: var(--accent-amber);
      font-weight: 600;
    }

    .shopping-category {
      margin-bottom: 0.5rem;
    }

    .shopping-category h4 {
      font-size: 0.7rem;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 0.2rem;
    }

    .shopping-item {
      font-size: 0.75rem;
      padding: 0.1rem 0;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .check-pantry {
      font-size: 0.6rem;
      color: var(--accent-amber);
    }

    /* TIMELINE MODE */
    .timeline-mode {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      width: 100vw;
      margin-left: calc(-50vw + 50%);
      padding: 0 1rem;
      box-sizing: border-box;
    }

    .timeline-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .timeline-header h2 {
      font-family: 'Crimson Pro', serif;
      font-size: 1.5rem;
      color: var(--accent-green);
    }

    .timeline-container {
      display: flex;
      gap: 2rem;
      overflow-x: auto;
      padding-bottom: 1rem;
    }

    .timeline-column {
      flex-shrink: 0;
      width: 100%;
    }

    .timeline-column h3 {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-bottom: 1rem;
    }

    .timeline-visual {
      position: relative;
      background: var(--bg-card);
      border-radius: 12px;
      border: 1px solid var(--border);
      min-height: 600px;
    }

    .timeline-hours {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 60px;
      border-right: 1px solid var(--border);
    }

    .timeline-hour {
      position: absolute;
      left: 0;
      width: 60px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.75rem;
      color: var(--text-muted);
      text-align: center;
      transform: translateY(-50%);
    }

    .timeline-hour::after {
      content: "";
      position: absolute;
      right: -5px;
      top: 50%;
      width: 10px;
      height: 1px;
      background: var(--border);
    }

    .timeline-events {
      position: absolute;
      left: 70px;
      right: 10px;
      top: 0;
      bottom: 0;
    }

    .timeline-event {
      position: absolute;
      background: rgba(74, 222, 128, 0.15);
      border-left: 3px solid var(--accent-green);
      border-radius: 0 6px 6px 0;
      padding: 0.5rem 0.5rem;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.2s;
      box-sizing: border-box;
    }

    .timeline-event:hover {
      background: rgba(74, 222, 128, 0.25);
    }

    .timeline-event.eating {
      background: rgba(248, 113, 113, 0.2);
      border-left-color: var(--accent-red);
    }

    .timeline-event.dessert {
      background: rgba(244, 114, 182, 0.15);
      border-left-color: var(--accent-pink);
    }

    .timeline-event.oven1 {
      background: rgba(251, 191, 36, 0.2);
      border-left-color: var(--accent-amber);
    }

    .timeline-event.oven2 {
      background: rgba(249, 115, 22, 0.2);
      border-left-color: #f97316;
    }

    .timeline-event.hob {
      background: rgba(96, 165, 250, 0.15);
      border-left-color: var(--accent-blue);
    }

    .timeline-event.airfryer {
      background: rgba(167, 139, 250, 0.15);
      border-left-color: var(--accent-purple);
    }

    .timeline-event-title {
      font-weight: 600;
      font-size: 0.7rem;
      line-height: 1.2;
      margin-bottom: 0.15rem;
    }

    .timeline-event-time {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.6rem;
      color: var(--text-secondary);
    }

    .timeline-event-tasks {
      font-size: 0.6rem;
      color: var(--text-secondary);
      margin-top: 0.15rem;
      line-height: 1.2;
    }

    .gap-indicator {
      position: absolute;
      left: 0;
      right: 0;
      background: repeating-linear-gradient(
        45deg,
        transparent,
        transparent 10px,
        rgba(74, 222, 128, 0.05) 10px,
        rgba(74, 222, 128, 0.05) 20px
      );
      border: 1px dashed var(--accent-green);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.75rem;
      color: var(--accent-green);
      opacity: 0.7;
    }

    /* Print styles - Liz mode (portrait, single column) */
    @media print {
      .header {
        position: static;
        background: white;
        border-bottom: 2px solid #333;
      }
      .header h1 { color: #1a5a1a; }
      .mode-switcher, .time-setter { display: none; }

      body {
        background: white;
        color: black;
      }

      .main {
        padding: 0;
        max-width: none;
      }
    }

    /* Liz mode print - portrait, single column */
    @media print {
      .liz-mode {
        max-width: none;
      }

      .liz-mode section {
        break-inside: avoid;
      }

      .liz-mode h2 {
        color: #1a5a1a;
        border-bottom-color: #333;
      }

      .liz-mode table {
        border: 1px solid #ccc;
      }

      .liz-mode th, .liz-mode td {
        border-bottom: 1px solid #ccc;
      }

      .status-badge {
        border: 1px solid currentColor;
      }
    }

    /* Page orientation based on which view is visible */
    @page {
      margin: 1cm;
    }

    @page liz {
      size: portrait;
    }

    @page timeline {
      size: landscape;
    }

    @media print {
      .liz-mode {
        page: liz;
      }

      .seb-mode {
        page: seb;
      }

      .timeline-mode {
        page: timeline;
      }
    }

    /* Modal styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 1rem;
    }

    .modal-content {
      background: var(--bg-card);
      border-radius: 12px;
      border: 1px solid var(--border);
      max-width: 700px;
      width: 100%;
      max-height: 80vh;
      display: flex;
      flex-direction: column;
    }

    .modal-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h3 {
      font-family: 'Crimson Pro', serif;
      font-size: 1.25rem;
      color: var(--accent-green);
      margin: 0;
    }

    .modal-close {
      background: transparent;
      border: none;
      color: var(--text-secondary);
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      transition: all 0.2s;
    }

    .modal-close:hover {
      background: var(--bg-dark);
      color: var(--text-primary);
    }

    .modal-body {
      padding: 1.5rem;
      overflow-y: auto;
      flex: 1;
    }

    .roadmap-output {
      background: var(--bg-dark);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 1rem;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.85rem;
      line-height: 1.6;
      white-space: pre;
      overflow-x: auto;
      color: var(--text-primary);
    }

    .modal-footer {
      padding: 1rem 1.5rem;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 0.75rem;
      justify-content: flex-end;
    }

    .btn {
      padding: 0.65rem 1.25rem;
      border: none;
      border-radius: 6px;
      font-family: 'Inter', sans-serif;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: var(--accent-green);
      color: var(--bg-dark);
    }

    .btn-primary:hover {
      background: #22c55e;
    }

    .btn-secondary {
      background: transparent;
      color: var(--text-secondary);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--bg-dark);
      color: var(--text-primary);
    }

    .export-btn {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-secondary);
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.6rem;
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'Inter', sans-serif;
      margin-left: auto;
    }

    .export-btn:hover {
      background: var(--accent-green);
      color: var(--bg-dark);
      border-color: var(--accent-green);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        align-items: flex-start;
      }

      .main {
        padding: 1rem;
      }

      .modal-content {
        max-height: 90vh;
      }

      .roadmap-output {
        font-size: 0.75rem;
      }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-content">
      <h1>Christmas Dinner 2025</h1>
      
      <div class="mode-switcher">
        <button class="mode-btn active" data-mode="seb">Seb Mode</button>
        <button class="mode-btn" data-mode="liz">Liz Mode</button>
        <button class="mode-btn" data-mode="timeline">Timeline</button>
      </div>
      
      <div class="time-setter">
        <label for="eating-time">Eating at:</label>
        <input type="time" id="eating-time" value="13:30">
      </div>
    </div>
  </header>

  <main class="main">
    <!-- SEB MODE -->
    <div id="seb-view" class="seb-mode">
      <!-- Content injected by JS -->
    </div>

    <!-- LIZ MODE -->
    <div id="liz-view" class="liz-mode" style="display: none;">
      <!-- Content injected by JS -->
    </div>

    <!-- TIMELINE MODE -->
    <div id="timeline-view" class="timeline-mode" style="display: none;">
      <!-- Content injected by JS -->
    </div>
  </main>

  <!-- Roadmap Export Modal -->
  <div id="roadmap-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Roadmap Format</h3>
        <button class="modal-close" id="close-modal">&times;</button>
      </div>
      <div class="modal-body">
        <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">
          Copy this format for your roadmap visualizer:
        </p>
        <div class="roadmap-output" id="roadmap-output"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="modal-cancel">Close</button>
        <button class="btn btn-primary" id="copy-roadmap">Copy to Clipboard</button>
      </div>
    </div>
  </div>

  <script>
    // Data loaded from JSON
    let data = null;

    // State
    let currentMode = 'seb';
    let eatingTime = '13:30';

    // Load data from JSON file
    async function loadData() {
      try {
        const response = await fetch('christmas-data.json?v=' + Date.now());
        data = await response.json();
        console.log('Data loaded:', data);
      } catch (error) {
        console.error('Failed to fetch/parse JSON:', error);
        document.querySelector('.main').innerHTML = `<p style="color: var(--accent-red); padding: 2rem;">Failed to load JSON: ${error.message}</p>`;
        return;
      }

      try {
        // Set eating time from data if available
        if (data.meta && data.meta.eatingTime) {
          eatingTime = data.meta.eatingTime;
          document.getElementById('eating-time').value = eatingTime;
        }

        render();
      } catch (error) {
        console.error('Failed to render:', error);
        document.querySelector('.main').innerHTML = `<p style="color: var(--accent-red); padding: 2rem;">Failed to render: ${error.message}</p>`;
      }
    }

    // Helper to get timeline array (handles JSON structure difference)
    function getTimeline() {
      return data.christmasDay.timeline || data.christmasDay;
    }

    // Helper to get shopping categories (handles JSON structure difference)
    function getShopping() {
      return data.shopping.categories || data.shopping;
    }

    // Helper to get task text (handles both string and object tasks)
    function getTaskText(task) {
      return typeof task === 'string' ? task : task.task;
    }

    // Generate roadmap format (adapted from generate-roadmap-timeline.js)
    function generateRoadmapFormat() {
      const timeline = getTimeline();
      const eatingDateTime = new Date(`2025-12-25T${eatingTime}:00`);

      // Group items by type (swimlane)
      const swimlanes = {
        'OVEN1': [],
        'OVEN2': [],
        'HOB': [],
        'STEAMER': [],
        'AIRFRYER': [],
        'MICROWAVE': [],
        'OTHER': []
      };

      // Convert T-minus to actual time and group by type
      timeline.forEach(item => {
        const startTime = new Date(eatingDateTime.getTime() + item.tMinus * 60000);
        const endTime = new Date(eatingDateTime.getTime() + (item.tMinusEnd !== undefined ? item.tMinusEnd : (item.tMinus + item.duration)) * 60000);

        const formatTime = (date) => {
          const hours = date.getHours();
          const minutes = date.getMinutes();
          const ampm = hours >= 12 ? 'pm' : 'am';
          const hour12 = hours % 12 || 12;
          return minutes === 0 ? `${hour12}${ampm}` : `${hour12}:${minutes.toString().padStart(2, '0')}${ampm}`;
        };

        const timeRange = `${formatTime(startTime)} to ${formatTime(endTime)}`;

        let swimlane = 'OTHER';
        if (item.type) {
            const type = item.type.toUpperCase();
            if (type in swimlanes) swimlane = type;
        }

        swimlanes[swimlane].push({
          name: item.name || item.title,
          time: timeRange,
          startTime
        });
      });

      // Sort items within each swimlane by start time
      Object.keys(swimlanes).forEach(key => {
        swimlanes[key].sort((a, b) => a.startTime - b.startTime);
      });

      // Generate human roadmap format output
      let output = 'CHRISTMAS DINNER\n';
      Object.entries(swimlanes).forEach(([swimlane, items]) => {
        if (items.length > 0) {
          output += `    ${swimlane}\n`;
          items.forEach(item => {
            output += `        ${item.name}  ${item.time}\n`;
          });
        }
      });

      return output;
    }

    // Utility functions
    function formatTime(minutes) {
      const h = Math.floor(Math.abs(minutes) / 60);
      const m = Math.abs(minutes) % 60;
      return `${h}:${m.toString().padStart(2, '0')}`;
    }

    function addMinutesToTime(timeStr, minutes) {
      const [h, m] = timeStr.split(':').map(Number);
      const totalMins = h * 60 + m + minutes;
      const newH = Math.floor(totalMins / 60) % 24;
      const newM = totalMins % 60;
      return `${newH.toString().padStart(2, '0')}:${newM.toString().padStart(2, '0')}`;
    }

    function getStatusClass(status) {
      const map = {
        done: 'status-done',
        prepped: 'status-prepped',
        mum: 'status-mum',
        todo: 'status-todo',
        tobuy: 'status-tobuy',
        ordered: 'status-todo'
      };
      return map[status] || 'status-todo';
    }

    function getStatusLabel(status) {
      const map = {
        done: '‚úì Done',
        prepped: '‚úì Prepped',
        mum: 'Mum',
        todo: 'To Do',
        tobuy: 'To Buy',
        ordered: 'Ordered'
      };
      return map[status] || status;
    }

    // Render functions
    function renderLizMode() {
      const container = document.getElementById('liz-view');
      
      container.innerHTML = `
        <section>
          <h2>The Team</h2>
          <p><strong>Chef:</strong> ${data.team.chef}</p>
          ${data.team.guests ? `<p><strong>Guests:</strong> ${data.team.guests.map(g => g.name).join(', ')}</p>` : ''}
          <p><strong>Total:</strong> ${data.team.totalPeople} people</p>
        </section>

        <section>
          <h2>The Menu</h2>
          
          <h3>Breakfast</h3>
          <p>${data.menu.breakfast.description}</p>
          
          <h3>Amuse Bouche</h3>
          <p>${data.menu.amuseBouche.name}</p>
          
          <h3>Mains</h3>
          <table>
            <tr><th>Item</th><th>Status</th><th>Notes</th></tr>
            ${data.menu.mains.map(m => `
              <tr>
                <td>${m.name}</td>
                <td><span class="${getStatusClass(m.status)}">${getStatusLabel(m.status)}</span></td>
                <td>${m.notes || m.method || ''}</td>
              </tr>
            `).join('')}
          </table>
          
          <h3>Sides</h3>
          <table>
            <tr><th>Item</th><th>Status</th><th>Notes</th></tr>
            ${data.menu.sides.map(s => `
              <tr>
                <td>${s.name}</td>
                <td><span class="status-badge ${getStatusClass(s.status)}">${getStatusLabel(s.status)}</span></td>
                <td>${s.notes || ''}</td>
              </tr>
            `).join('')}
          </table>
          
          <h3>Desserts</h3>
          <table>
            <tr><th>Item</th><th>Status</th><th>Notes</th></tr>
            ${data.menu.desserts.map(d => `
              <tr>
                <td>${d.name}</td>
                <td><span class="status-badge ${getStatusClass(d.status)}">${getStatusLabel(d.status)}</span></td>
                <td>${d.notes || ''}</td>
              </tr>
            `).join('')}
          </table>
        </section>

        <section>
          <h2>Before Christmas Day</h2>
          ${data.keyDates.map(kd => `
            <h3>${kd.title}</h3>
            <ul>
              ${kd.tasks.map(t => `
                <li class="${t.done ? 'task-done' : ''} ${t.important ? 'task-important' : ''}">${t.task}</li>
              `).join('')}
            </ul>
          `).join('')}
        </section>

        <section>
          <h2>Christmas Day Timeline</h2>
          <p style="margin-bottom: 1rem;"><em>Eating at: ${eatingTime}</em></p>
          <table style="width: 100%; border-collapse: collapse;">
            <tbody>
            ${getTimeline().map(slot => `
              <tr>
                <td style="font-family: 'JetBrains Mono', monospace; font-size: 0.9rem; color: var(--text-secondary); padding: 0.4rem 1rem 0.4rem 0; vertical-align: top; white-space: nowrap; width: 50px;">${addMinutesToTime(eatingTime, slot.tMinus)}</td>
                <td style="padding: 0.4rem 1rem 0.4rem 0; vertical-align: top; white-space: nowrap; font-weight: 600; width: 150px;">${slot.title}</td>
                <td style="padding: 0.4rem 0; vertical-align: top; color: var(--text-secondary); font-size: 0.9rem;">${slot.tasks.map(t => getTaskText(t)).join('<br>')}</td>
              </tr>
            `).join('')}
            </tbody>
          </table>
        </section>

        <section>
          <h2>Shopping List ‚Äî ${data.shopping.store || 'Tesco'} ${data.shopping.orderDate || 'Monday 22nd'}</h2>
          ${getShopping().map(cat => `
            <h3>${cat.name}</h3>
            <ul>
              ${cat.items.map(i => `
                <li class="${i.have ? 'task-done' : ''}">${i.item}${i.checkPantry ? ' <span class="check-pantry">(check pantry)</span>' : ''}</li>
              `).join('')}
            </ul>
          `).join('')}
        </section>
      `;
    }

    function renderSebMode() {
      const container = document.getElementById('seb-view');

      container.innerHTML = `
        <div class="seb-card">
          <h2>Now ‚Üí 24th Dec</h2>
          ${data.keyDates.map(kd => `
            <h4 style="color: var(--text-secondary); font-size: 0.7rem; margin: 0.5rem 0 0.25rem;">${kd.title}</h4>
            <ul class="task-list">
              ${kd.tasks.map((t, i) => `
                <li class="task-item">
                  <div class="task-checkbox ${t.done ? 'checked' : ''}" data-date="${kd.date}" data-task="${i}"></div>
                  <span class="task-text ${t.done ? 'completed' : ''} ${t.important ? 'task-important' : ''}">${t.task}</span>
                </li>
              `).join('')}
            </ul>
          `).join('')}
        </div>

        <div class="seb-card">
          <h2 style="display: flex; align-items: center; width: 100%;">
            <span style="flex: 1;">Christmas Day</span>
            <button class="export-btn" id="export-roadmap">üìã Export Roadmap</button>
          </h2>
          <table style="width: 100%; border-collapse: collapse; font-size: 0.7rem;">
            <tbody>
            ${getTimeline().map(slot => `
              <tr>
                <td style="font-family: 'JetBrains Mono', monospace; font-size: 0.6rem; color: var(--text-secondary); padding: 0.15rem 0.3rem 0.15rem 0; vertical-align: top; white-space: nowrap;">${addMinutesToTime(eatingTime, slot.tMinus)}</td>
                <td style="font-family: 'JetBrains Mono', monospace; font-size: 0.55rem; color: var(--text-muted); padding: 0.15rem 0.3rem 0.15rem 0; vertical-align: top; white-space: nowrap;">${slot.duration ? (slot.duration >= 60 ? Math.floor(slot.duration / 60) + 'h' + (slot.duration % 60 ? slot.duration % 60 + 'm' : '') : slot.duration + 'm') : ''}</td>
                <td style="padding: 0.15rem 0.3rem 0.15rem 0; vertical-align: top; white-space: nowrap; font-weight: 600; font-size: 0.7rem;">${slot.title}</td>
                <td style="padding: 0.15rem 0; vertical-align: top; color: var(--text-secondary); font-size: 0.65rem;">${slot.tasks.map(t => getTaskText(t)).join('<br>')}</td>
              </tr>
            `).join('')}
            </tbody>
          </table>
        </div>

        <div class="seb-card">
          <h2>Menu Status</h2>
          ${[...data.menu.mains, ...data.menu.sides, ...data.menu.desserts].map(item => `
            <div class="menu-item">
              <span class="menu-item-name">${item.name}</span>
              <span class="status-badge ${getStatusClass(item.status)}">${getStatusLabel(item.status)}</span>
            </div>
          `).join('')}
        </div>

        <div class="seb-card">
          <h2>Equipment</h2>
          ${data.equipment.map(e => `
            <div class="menu-item">
              <span>${e.item}</span>
              <span style="color: var(--text-muted);">√ó${e.qty}</span>
            </div>
          `).join('')}
        </div>

        <div class="seb-card">
          <h2>The Plate</h2>
          <p style="font-size: 0.7rem; color: var(--text-secondary); margin-bottom: 0.3rem;">What goes on each plate:</p>
          <div style="display: flex; flex-wrap: wrap; gap: 0.25rem;">
            ${(data.plate?.mainPlate || ['Turkey', 'Ham', 'Roasties', 'Parsnips', 'Yorkshire', 'Pigs in blankets', 'Sprouts', 'Red cabbage', 'Carrots', 'Stuffing', 'Gravy']).map(item => `
              <span style="background: var(--bg-dark); padding: 0.15rem 0.35rem; border-radius: 3px; font-size: 0.7rem;">${item}</span>
            `).join('')}
          </div>
        </div>

        <div class="seb-card">
          <h2>Shopping ‚Äî ${data.shopping.orderDate || 'Monday 22nd'}</h2>
          ${getShopping().map(cat => `
            <div class="shopping-category">
              <h4>${cat.name}</h4>
              ${cat.items.map(i => `
                <div class="shopping-item">
                  <span>${i.have ? '‚úì' : '‚òê'} ${i.item}</span>
                  ${i.checkPantry ? '<span class="check-pantry">check?</span>' : ''}
                </div>
              `).join('')}
            </div>
          `).join('')}
        </div>
      `;

      // Add click handlers for checkboxes
      container.querySelectorAll('.task-checkbox').forEach(cb => {
        cb.addEventListener('click', function() {
          this.classList.toggle('checked');
          this.nextElementSibling.classList.toggle('completed');
        });
      });

      // Add click handler for export roadmap button
      const exportBtn = document.getElementById('export-roadmap');
      if (exportBtn) {
        exportBtn.addEventListener('click', function() {
          const roadmapText = generateRoadmapFormat();
          document.getElementById('roadmap-output').textContent = roadmapText;
          document.getElementById('roadmap-modal').style.display = 'flex';
        });
      }
    }

    function renderTimelineMode() {
      const container = document.getElementById('timeline-view');
      const timeline = getTimeline();

      // Calculate pixel positions (1 hour = 80px)
      const hourHeight = 80;
      const startHour = parseInt(eatingTime.split(':')[0]) - 6;
      const totalHours = 9; // 6 hours before to 2 hours after

      let hoursHtml = '';
      for (let i = 0; i <= totalHours; i++) {
        const hour = (startHour + i) % 24;
        const displayHour = hour.toString().padStart(2, '0') + ':00';
        hoursHtml += `<div class="timeline-hour" style="top: ${i * hourHeight}px;">${displayHour}</div>`;
      }

      // Calculate start/end times for each event and assign columns for overlaps
      const events = timeline.map(slot => {
        const startMins = (parseInt(eatingTime.split(':')[0]) * 60 + parseInt(eatingTime.split(':')[1])) + slot.tMinus;
        return {
          ...slot,
          startMins,
          endMins: startMins + slot.duration,
          column: 0
        };
      });

      // Sort by start time
      events.sort((a, b) => a.startMins - b.startMins);

      // Assign columns to avoid overlaps
      events.forEach((event, i) => {
        // Find which columns are occupied at this event's start time
        const occupiedColumns = new Set();
        for (let j = 0; j < i; j++) {
          if (events[j].endMins > event.startMins) {
            occupiedColumns.add(events[j].column);
          }
        }
        // Find first free column
        let col = 0;
        while (occupiedColumns.has(col)) col++;
        event.column = col;
      });

      const maxColumns = Math.max(...events.map(e => e.column)) + 1;
      const columnWidth = 100 / maxColumns;

      let eventsHtml = '';
      events.forEach(slot => {
        const topPos = (slot.startMins - startHour * 60) / 60 * hourHeight;
        const height = slot.duration / 60 * hourHeight;
        const typeClass = slot.type || '';
        const leftPos = slot.column * columnWidth;

        eventsHtml += `
          <div class="timeline-event ${typeClass}" style="top: ${topPos}px; height: ${height}px; left: ${leftPos}%; width: ${columnWidth}%;">
            <div class="timeline-event-title">${slot.title}</div>
            ${height > 20 ? `<div class="timeline-event-time">${addMinutesToTime(eatingTime, slot.tMinus)}</div>` : ''}
          </div>
        `;
      });

      container.innerHTML = `
        <div class="timeline-header">
          <h2>Christmas Day Timeline</h2>
          <p style="color: var(--text-secondary);">Eating at ${eatingTime} ‚Ä¢ Green = gaps for presents! üéÅ</p>
        </div>
        
        <div class="timeline-column">
          <div class="timeline-visual" style="height: ${totalHours * hourHeight + 40}px;">
            <div class="timeline-hours">
              ${hoursHtml}
            </div>
            <div class="timeline-events">
              ${eventsHtml}
            </div>
          </div>
        </div>
      `;
    }

    function render() {
      if (!data) return; // Wait for data to load

      document.getElementById('liz-view').style.display = currentMode === 'liz' ? 'block' : 'none';
      document.getElementById('seb-view').style.display = currentMode === 'seb' ? 'grid' : 'none';
      document.getElementById('timeline-view').style.display = currentMode === 'timeline' ? 'flex' : 'none';

      if (currentMode === 'liz') renderLizMode();
      if (currentMode === 'seb') renderSebMode();
      if (currentMode === 'timeline') renderTimelineMode();
    }

    // Event listeners
    document.querySelectorAll('.mode-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        currentMode = this.dataset.mode;
        render();
      });
    });

    document.getElementById('eating-time').addEventListener('change', function() {
      eatingTime = this.value;
      render();
    });

    // Modal event handlers
    const modal = document.getElementById('roadmap-modal');
    const closeModalBtn = document.getElementById('close-modal');
    const cancelBtn = document.getElementById('modal-cancel');
    const copyBtn = document.getElementById('copy-roadmap');

    // Close modal when clicking X or Cancel
    closeModalBtn.addEventListener('click', () => {
      modal.style.display = 'none';
    });

    cancelBtn.addEventListener('click', () => {
      modal.style.display = 'none';
    });

    // Close modal when clicking outside the content
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.style.display = 'none';
      }
    });

    // Copy to clipboard
    copyBtn.addEventListener('click', async () => {
      const roadmapText = document.getElementById('roadmap-output').textContent;
      try {
        await navigator.clipboard.writeText(roadmapText);
        // Visual feedback
        const originalText = copyBtn.textContent;
        copyBtn.textContent = '‚úì Copied!';
        setTimeout(() => {
          copyBtn.textContent = originalText;
        }, 2000);
      } catch (err) {
        console.error('Failed to copy:', err);
        // Fallback for older browsers
        const textarea = document.createElement('textarea');
        textarea.value = roadmapText;
        textarea.style.position = 'fixed';
        textarea.style.opacity = '0';
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);

        const originalText = copyBtn.textContent;
        copyBtn.textContent = '‚úì Copied!';
        setTimeout(() => {
          copyBtn.textContent = originalText;
        }, 2000);
      }
    });

    // Load data and render
    loadData();
  </script>
</body>
</html>
